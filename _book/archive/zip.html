<!DOCTYPE HTML>
<html lang="en-US" manifest="../manifest.appcache">
    
    <head>
        
        <meta charset="UTF-8">
        <title>zip | </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 0.7.0">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <meta name="author" content="goManual">
    
    
    
    <link rel="prev" href="../archive/tar.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">


        
    <div class="book" data-github="goManual/goManual" data-level="1.2" data-basepath=".." data-revision="1408449739157">
    <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    
    <a href="https://github.com/goManual/goManual" target="_blank" class="btn pull-left home-bookmark" aria-label="GitHub home"><i class="fa fa-bookmark-o"></i></a>
    
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="btn-group btn-block">
        <button id="reduce-font-size" class="btn btn-default">A</button>
        <button id="enlarge-font-size" class="btn btn-default">A</button>
    </div>

    <ul class="list-group font-family-list">
        <li class="list-group-item" data-font="0">Serif</li>
        <li class="list-group-item" data-font="1">Sans</li>
    </ul>

    <div class="btn-group btn-group-xs btn-block color-theme-list">
        <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
    </div>
</div>

    </span>

    <!-- Actions Right -->
    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-spinner fa-spin"></i>
        <a href="../" ></a>
    </h1>
</div>

    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        <li>
            <a href="https://github.com/goManual" target="blank" class="author-link">About the author</a>
        </li>
        

        
        
        <li>
            <a href="https://github.com/goManual/goManual/issues" target="blank" class="issues-link">Questions and Issues</a>
        </li>
        

        
        
        <li>
            <a href="https://github.com/goManual/goManual/edit/master/archive/zip.md" target="blank" class="contribute-link">Edit and Contribute</a>
        </li>
        

	

        
        <li class="divider"></li>
        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                         简介
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="archive/README.html">
            
                
                    <a href="../archive/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         archive
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" data-path="archive/tar.html">
            
                
                    <a href="../archive/tar.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                         tar
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="1.2" data-path="archive/zip.html">
            
                
                    <a href="../archive/zip.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                         zip
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Generated using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 100%;min-width: 66.66666666666667%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../index.html" title="简介" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../archive/README.html" title="archive" class="chapter done new-chapter" data-progress="1" style="left: 33.333333333333336%;"></a>
    
        <a href="../archive/tar.html" title="tar" class="chapter done " data-progress="1.1" style="left: 66.66666666666667%;"></a>
    
        <a href="../archive/zip.html" title="zip" class="chapter done " data-progress="1.2" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_1262">
                    
                        <h1 id="package-zip">Package zip</h1>
<h3 id="overview">Overview</h3>
<p>Package zip provides support for reading and writing ZIP archives.<br>
读取和写入 ZIP归档<br></p>
<p>See: <a href="http://www.pkware.com/documents/casestudies/APPNOTE.TXT" target="_blank">http://www.pkware.com/documents/casestudies/APPNOTE.TXT</a><br></p>
<p>This package does not support disk spanning.<br>
这个包不支持磁盘跨越</p>
<p>A note about ZIP64:<br>
To be backwards compatible the FileHeader has both 32 and 64 bit Size fields. The 64 bit fields will always contain the correct value and for normal archives both fields will be the same. For files requiring the ZIP64 format the 32 bit fields will be 0xffffffff and the 64 bit fields must be used instead.<br>
ZIP64注意:为了向后兼容的FileHeader里有32位和64位字段。64位包含的值和归档总是正确的。<br></p>
<h3 id="constants">Constants</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">const</span> (
    Store   <span class="hljs-typename">uint16</span> =<span class="hljs-number"> 0</span>
    Deflate <span class="hljs-typename">uint16</span> =<span class="hljs-number"> 8</span>
)
Compression methods.
</code></pre>
<h3 id="variables">Variables</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">var</span> (
    ErrFormat    = errors.New(<span class="hljs-string">"zip: not a valid zip file"</span>)
    ErrAlgorithm = errors.New(<span class="hljs-string">"zip: unsupported compression algorithm"</span>)
    ErrChecksum  = errors.New(<span class="hljs-string">"zip: checksum error"</span>)
)
</code></pre>
<h2 id="func-registercompressor">func RegisterCompressor</h2>
<pre><code class="lang-golang"><span class="hljs-keyword">func</span> RegisterCompressor(method <span class="hljs-typename">uint16</span>, comp Compressor)
</code></pre>
<p>RegisterCompressor registers custom compressors for a specified method ID. The common methods Store and Deflate are built in.<br>
RegisterCompressor 为指定的方法ID注册自定义压缩器。常见的方法Store和Deflate是内置<br>
<br><br></p>
<h3 id="func-registerdecompressor">func RegisterDecompressor</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">func</span> RegisterDecompressor(method <span class="hljs-typename">uint16</span>, d Decompressor)
</code></pre>
<p>RegisterDecompressor allows custom decompressors for a specified method ID.<br>
RegisterDecompressor 允许为指定的方法ID自定义解压器<br>
<br><br></p>
<h3 id="type-compressor">type Compressor</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">type</span> Compressor <span class="hljs-keyword">func</span>(io.Writer) (io.WriteCloser, error)
</code></pre>
<p>A Compressor returns a compressing writer, writing to the provided writer. On Close, any pending data should be flushed.<br>
Compressor返回一个压缩的writer，writer提供写。Close时,任何挂起的数据都被刷新.<br>
<br><br></p>
<h3 id="type-decompressor">type Decompressor</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">type</span> Decompressor <span class="hljs-keyword">func</span>(io.Reader) io.ReadCloser
</code></pre>
<p>Decompressor is a function that wraps a Reader with a decompressing Reader. The decompressed ReadCloser is returned to callers who open files from within the archive. These callers are responsible for closing this reader when they&#39;re finished reading.<br>
Decompressor 是一个封装Reader和解压的Reader的函数。解压的ReadCloser返回给调用者从归档内打开的文件。这些调用者负责当他们结束读取时关闭这些reader.<br>
<br><br></p>
<h3 id="type-file">type File</h3>
<pre><code class="lang-golang">  <span class="hljs-keyword">type</span> File <span class="hljs-keyword">struct</span> {
        FileHeader
        <span class="hljs-comment">// contains filtered or unexported fields</span>
  }
</code></pre>
<h3 id="func-file-dataoffset">func (*File) DataOffset</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">func</span> (f *File) DataOffset() (offset <span class="hljs-typename">int64</span>, err error)
</code></pre>
<p>DataOffset returns the offset of the file&#39;s possibly-compressed data, relative to the beginning of the zip file.<br>
Most callers should instead use Open, which transparently decompresses data and verifies checksums.<br>
DataOffset返回文件可能压缩数据的偏移,相对ZIP文件的开头.<br>
大部分的调用者应该使用Open 代替它,其透明地解压缩数据和验证校验。<br>
<br><br></p>
<h3 id="func-f-file-open">func (f *File) Open</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">func</span> (f *File) Open() (rc io.ReadCloser, err error)
</code></pre>
<p>Open returns a ReadCloser that provides access to the File&#39;s contents. Multiple files may be read concurrently.<br>
Open 返回ReadCloser那可以用来访问File的内容. 多个文件可以同时读取.<br>
<br><br></p>
<h3 id="type-fileheader">type FileHeader</h3>
<pre><code class="lang-golang">  <span class="hljs-keyword">type</span> FileHeader <span class="hljs-keyword">struct</span> {
        <span class="hljs-comment">// Name is the name of the file. 文件名称</span>
        <span class="hljs-comment">// It must be a relative path: it must not start with a drive 必须是一个真实存在的文件，必须处于未打开的状态</span>
        <span class="hljs-comment">// letter (e.g. C:) or leading slash, and only forward slashes  （就是相当于linux和windows目录开头）</span>
        <span class="hljs-comment">// are allowed.</span>
        Name <span class="hljs-typename">string</span>

        CreatorVersion     <span class="hljs-typename">uint16</span>
        ReaderVersion      <span class="hljs-typename">uint16</span>
        Flags              <span class="hljs-typename">uint16</span>
        Method             <span class="hljs-typename">uint16</span>
        ModifiedTime       <span class="hljs-typename">uint16</span> <span class="hljs-comment">// MS-DOS time dos的时间</span>
        ModifiedDate       <span class="hljs-typename">uint16</span> <span class="hljs-comment">// MS-DOS date dos的数据</span>
        CRC32              <span class="hljs-typename">uint32</span>
        CompressedSize     <span class="hljs-typename">uint32</span> <span class="hljs-comment">// deprecated; use CompressedSize64</span>
        UncompressedSize   <span class="hljs-typename">uint32</span> <span class="hljs-comment">// deprecated; use UncompressedSize64</span>
        CompressedSize64   <span class="hljs-typename">uint64</span>
        UncompressedSize64 <span class="hljs-typename">uint64</span>
        Extra              []<span class="hljs-typename">byte</span>
        ExternalAttrs      <span class="hljs-typename">uint32</span> <span class="hljs-comment">// Meaning depends on CreatorVersion</span>
        Comment            <span class="hljs-typename">string</span>
  }
</code></pre>
<p>FileHeader describes a file within a zip file. See the zip spec for details.<br>
FileHeader描述zip的文件信息<br>
<br><br></p>
<h3 id="func-fileinfoheader">func FileInfoHeader</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">func</span> FileInfoHeader(fi os.FileInfo) (*FileHeader, error)
</code></pre>
<p>FileInfoHeader creates a partially-populated FileHeader from an os.FileInfo.<br>
FileInfoHeader 从一个os.FileInfo创建部分填充的FileHeader<br>
<br><br></p>
<h3 id="func-h-fileheader-fileinfo">func (h *FileHeader) FileInfo</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">func</span> (h *FileHeader) FileInfo() os.FileInfo
</code></pre>
<p>FileInfo returns an os.FileInfo for the FileHeader.<br>
FileInfo 为FileHeader返回一个os.FileInfo.<br>
<br><br></p>
<h3 id="func-h-fileheader-modtime">func (h *FileHeader) ModTime</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">func</span> (h *FileHeader) ModTime() time.Time
</code></pre>
<p>ModTime returns the modification time. The resolution is 2s.<br>
ModTime 返回修改时间. 间隔2S.<br>
<br><br></p>
<h3 id="func-h-fileheader-mode">func (h *FileHeader) Mode</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">func</span> (h *FileHeader) Mode() (mode os.FileMode)
</code></pre>
<p>Mode returns the permission and mode bits for the FileHeader.<br>
Mode返回FileHeader的权限和模式位<br>
<br><br></p>
<h3 id="func-h-fileheader-setmodtime">func (h *FileHeader) SetModTime</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">func</span> (h *FileHeader) SetModTime(t time.Time)
</code></pre>
<p>SetModTime sets the ModifiedTime and ModifiedDate fields to the given time. The resolution is 2s.<br>
SetModTime 使用给定的时间设置ModifiedTime和ModifiedDate字段。<br>
<br><br></p>
<h3 id="func-h-fileheader-setmode">func (h *FileHeader) SetMode</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">func</span> (h *FileHeader) SetMode(mode os.FileMode)
</code></pre>
<p>SetMode changes the permission and mode bits for the FileHeader.<br>
SetMode 修改FileHeader的权限和模式位<br>
<br><br></p>
<h3 id="type-readcloser">type ReadCloser</h3>
<pre><code class="lang-golang">  <span class="hljs-keyword">type</span> ReadCloser <span class="hljs-keyword">struct</span> {
        Reader
        <span class="hljs-comment">// contains filtered or unexported fields</span>
  }
</code></pre>
<h3 id="func-openreader">func OpenReader</h3>
<pre><code class="lang-golang">  <span class="hljs-keyword">func</span> OpenReader(name <span class="hljs-typename">string</span>) (*ReadCloser, error)
</code></pre>
<p>OpenReader will open the Zip file specified by name and return a ReadCloser.<br>
OpenReader打开指定名称的zip文件并返回ReadCloser.<br>
<br><br></p>
<h3 id="func-rc-readcloser-close">func (rc *ReadCloser) Close</h3>
<pre><code class="lang-golang">  <span class="hljs-keyword">func</span> (rc *ReadCloser) Close() error
</code></pre>
<p>Close closes the Zip file, rendering it unusable for I/O.<br>
Close关闭zip文件. 使其无法使用I/O.<br>
<br><br></p>
<h3 id="type-reader">type Reader</h3>
<pre><code class="lang-golang">  <span class="hljs-keyword">type</span> Reader <span class="hljs-keyword">struct</span> {
        File    []*File
        Comment <span class="hljs-typename">string</span>
        <span class="hljs-comment">// contains filtered or unexported fields</span>
  }
</code></pre>
<h3 id="-example">▾ Example</h3>
<p>Code:</p>
<pre><code class="lang-golang"><span class="hljs-comment">//例子</span>
<span class="hljs-comment">// Open a zip archive for reading.</span>
r, err := zip.OpenReader(<span class="hljs-string">"testdata/readme.zip"</span>)
<span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
    log.Fatal(err)
}
<span class="hljs-keyword">defer</span> r.Close()

<span class="hljs-comment">// Iterate through the files in the archive,</span>
<span class="hljs-comment">// printing some of their contents.</span>
<span class="hljs-keyword">for</span> _, f := <span class="hljs-keyword">range</span> r.File {
    fmt.Printf(<span class="hljs-string">"Contents of %s:\n"</span>, f.Name)
    rc, err := f.Open()
    <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
        log.Fatal(err)
    }
    _, err = io.CopyN(os.Stdout, rc,<span class="hljs-number"> 68</span>)
    <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
        log.Fatal(err)
    }
    rc.Close()
    fmt.Println()
}
</code></pre>
<p><br><br>
Output:</p>
<pre><code class="lang-golang">Contents of README:
This is the source code repository <span class="hljs-keyword">for</span> the Go programming language.
</code></pre>
<p><br><br></p>
<h3 id="func-newreader">func NewReader</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">func</span> NewReader(r io.ReaderAt, size <span class="hljs-typename">int64</span>) (*Reader, error)
</code></pre>
<p>NewReader returns a new Reader reading from r, which is assumed to have the given size in bytes.<br>
NewReader 从r返回一个新Reader, 这假定其具有以字节为单位给定的尺寸。<br>
<br><br></p>
<h3 id="type-writer">type Writer</h3>
<pre><code class="lang-golang">  <span class="hljs-keyword">type</span> Writer <span class="hljs-keyword">struct</span> {
    <span class="hljs-comment">// contains filtered or unexported fields</span>
  }
  Writer implements a zip file writer.
</code></pre>
<p><br><br></p>
<pre><code class="lang-golang"><span class="hljs-comment">// Create a buffer to write our archive to.</span>
buf := <span class="hljs-built_in">new</span>(bytes.Buffer)

<span class="hljs-comment">// Create a new zip archive.</span>
w := zip.NewWriter(buf)

<span class="hljs-comment">// Add some files to the archive.</span>
<span class="hljs-keyword">var</span> files = []<span class="hljs-keyword">struct</span> {
    Name, Body <span class="hljs-typename">string</span>
}{
    {<span class="hljs-string">"readme.txt"</span>, <span class="hljs-string">"This archive contains some text files."</span>},
    {<span class="hljs-string">"gopher.txt"</span>, <span class="hljs-string">"Gopher names:\nGeorge\nGeoffrey\nGonzo"</span>},
    {<span class="hljs-string">"todo.txt"</span>, <span class="hljs-string">"Get animal handling licence.\nWrite more examples."</span>},
}
<span class="hljs-keyword">for</span> _, file := <span class="hljs-keyword">range</span> files {
    f, err := w.Create(file.Name)
    <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
        log.Fatal(err)
    }
    _, err = f.Write([]<span class="hljs-typename">byte</span>(file.Body))
    <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
        log.Fatal(err)
    }
}

<span class="hljs-comment">// Make sure to check the error on Close.</span>
err := w.Close()
<span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
    log.Fatal(err)
}
</code></pre>
<p><br><br></p>
<h3 id="func-newwriter">func NewWriter</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">func</span> NewWriter(w io.Writer) *Writer
</code></pre>
<p>NewWriter returns a new Writer writing a zip file to w.<br>
NewWriter 返回一个新的Writer,写一个zip文件到w.<br>
<br><br></p>
<h3 id="func-writer-close">func (*Writer) Close</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">func</span> (w *Writer) Close() error
</code></pre>
<p>Close finishes writing the zip file by writing the central directory. It does not (and can not) close the underlying writer.<br>
Close 结束写入ZIP文件。它不会（也不能）关闭底层writer<br>
<br><br></p>
<h3 id="func-w-writer-create">func (w *Writer) Create</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">func</span> (w *Writer) Create(name <span class="hljs-typename">string</span>) (io.Writer, error)
</code></pre>
<p>Create adds a file to the zip file using the provided name. It returns a Writer to which the file contents should be written. The name must be a relative path: it must not start with a drive letter (e.g. C:) or leading slash, and only forward slashes are allowed. The file&#39;s contents must be written to the io.Writer before the next call to Create, CreateHeader, or Close.<br>
Create 使用提供的name添加一个文件到ZIP文件。文件内容可写入的情况下返回Writer。name必须是相对路径：不能以字母(e.g. C:) 或者前斜杠开头，只能用正斜杠。文件内容必须在下一次调用Create、CreateHeader 或 Close 前写入io.Writer.<br>
<br><br></p>
<h3 id="func-w-writer-createheader">func (w *Writer) CreateHeader</h3>
<pre><code class="lang-golang"><span class="hljs-keyword">func</span> (w *Writer) CreateHeader(fh *FileHeader) (io.Writer, error)
</code></pre>
<p>CreateHeader adds a file to the zip file using the provided FileHeader for the file metadata. It returns a Writer to which the file contents should be written. The file&#39;s contents must be written to the io.Writer before the next call to Create, CreateHeader, or Close.<br>
CreateHeader使用FileHeader的文件元数据 添加一个文件到ZIP文件. 文件可写入的情况下返回Writer. 文件内容必须在下一次调用Create、CreateHeader 或 Close 前写入io.Writer.<br>
<br><br></p>

                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../archive/tar.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: tar"><i class="fa fa-angle-left"></i></a>
        
        
    </div>
</div>

        
<script src="../gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
<script src="../gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
